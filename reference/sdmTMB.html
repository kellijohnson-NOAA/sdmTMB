<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a spatial or spatiotemporal GLMM with TMB — sdmTMB • sdmTMB</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a spatial or spatiotemporal GLMM with TMB — sdmTMB" />
<meta property="og:description" content="Fit a spatial or spatiotemporal GLMM with TMB. Particularly useful for
species distribution models and relative abundance index standardization." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sdmTMB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6.9009</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/index-standardization.html">Index standardization with sdmTMB</a>
    </li>
    <li>
      <a href="../articles/spatial-trend-models.html">Fitting spatial trend models with sdmTMB</a>
    </li>
    <li>
      <a href="../articles/threshold-models.html">Threshold modeling with sdmTMB</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/seananderson/sdmTMB/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a spatial or spatiotemporal GLMM with TMB</h1>
    <small class="dont-index">Source: <a href='https://github.com/seananderson/sdmTMB/blob/master/R/fit.R'><code>R/fit.R</code></a></small>
    <div class="hidden name"><code>sdmTMB.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a spatial or spatiotemporal GLMM with TMB. Particularly useful for
species distribution models and relative abundance index standardization.</p>
    </div>

    <pre class="usage"><span class='fu'>sdmTMB</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>data</span>,
  <span class='va'>spde</span>,
  time <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span>,
  time_varying <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  reml <span class='op'>=</span> <span class='cn'>FALSE</span>,
  silent <span class='op'>=</span> <span class='cn'>TRUE</span>,
  multiphase <span class='op'>=</span> <span class='cn'>TRUE</span>,
  anisotropy <span class='op'>=</span> <span class='cn'>FALSE</span>,
  control <span class='op'>=</span> <span class='fu'><a href='sdmTMBcontrol.html'>sdmTMBcontrol</a></span><span class='op'>(</span><span class='op'>)</span>,
  enable_priors <span class='op'>=</span> <span class='cn'>FALSE</span>,
  ar1_fields <span class='op'>=</span> <span class='cn'>FALSE</span>,
  include_spatial <span class='op'>=</span> <span class='cn'>TRUE</span>,
  spatial_trend <span class='op'>=</span> <span class='cn'>FALSE</span>,
  normalize <span class='op'>=</span> <span class='cn'>FALSE</span>,
  spatial_only <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>[[</span><span class='va'>time</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>1L</span><span class='op'>)</span>,
  nlminb_loops <span class='op'>=</span> <span class='fl'>1</span>,
  newton_steps <span class='op'>=</span> <span class='fl'>0</span>,
  mgcv <span class='op'>=</span> <span class='cn'>TRUE</span>,
  previous_fit <span class='op'>=</span> <span class='cn'>NULL</span>,
  quadratic_roots <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>Model formula. See the Details section below for how to specify
offsets and threshold parameters. For index standardization, include <code>0 + as.factor(year)</code> (or whatever the time column is called) in the formula.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>spde</th>
      <td><p>An object from <code><a href='make_spde.html'>make_spde()</a></code>.</p></td>
    </tr>
    <tr>
      <th>time</th>
      <td><p>The time column (as character).</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>The family and link. Supports <code><a href='https://rdrr.io/r/stats/family.html'>gaussian()</a></code>, <code><a href='Beta.html'>Gamma()</a></code>,
<code><a href='https://rdrr.io/r/stats/family.html'>binomial()</a></code>, <code><a href='https://rdrr.io/r/stats/family.html'>poisson()</a></code>, <code><a href='Beta.html'>nbinom2()</a></code>, and <code><a href='Beta.html'>tweedie()</a></code>.</p></td>
    </tr>
    <tr>
      <th>time_varying</th>
      <td><p>An optional formula describing covariates that should be
modelled as a random walk through time.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Optional likelihood weights for the conditional model.
Implemented as in <span class="pkg">glmmTMB</span>. In other words, weights do not have to sum
to one and are not internally modified.</p></td>
    </tr>
    <tr>
      <th>reml</th>
      <td><p>Logical: use REML estimation rather than maximum likelihood?</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Silent or include optimization details?</p></td>
    </tr>
    <tr>
      <th>multiphase</th>
      <td><p>Logical: estimate the fixed and random effects in phases?
Phases are usually faster and more stable.</p></td>
    </tr>
    <tr>
      <th>anisotropy</th>
      <td><p>Logical: allow for anisotropy? See <code><a href='plot_anisotropy.html'>plot_anisotropy()</a></code>.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>Optimization control options. See <code><a href='sdmTMBcontrol.html'>sdmTMBcontrol()</a></code>.</p></td>
    </tr>
    <tr>
      <th>enable_priors</th>
      <td><p>Should weakly informative priors be enabled?
Experimental and likely for use with the <span class="pkg">tmbstan</span> package. Note that
the priors are not yet sensible and Jacobian adjustments are not made. If you
are interested in this functionality, please contact the developers.</p></td>
    </tr>
    <tr>
      <th>ar1_fields</th>
      <td><p>Estimate the spatiotemporal random fields as an AR1
process? Note that the parameter <code>ar1_phi</code> has been internally bounded
between <code>-1</code> and <code>1</code> with:  <code>2 * invlogit(ar1_phi) - 1</code> i.e. in R <code>2 * plogis(ar_phi) - 1</code>.</p></td>
    </tr>
    <tr>
      <th>include_spatial</th>
      <td><p>Should a separate spatial random field be estimated?
If enabled then there will be a separate spatial field and spatiotemporal
fields.</p></td>
    </tr>
    <tr>
      <th>spatial_trend</th>
      <td><p>Should a separate spatial field be included in the
trend? Requires spatiotemporal data.</p></td>
    </tr>
    <tr>
      <th>normalize</th>
      <td><p>Logical: should the normalization of the random effects be
done in R during the outer-optimization step? For some cases, especially
with many knots, this may be faster. In others, it may be slower or suffer
from convergence problems. <em>Currently disabled!</em></p></td>
    </tr>
    <tr>
      <th>spatial_only</th>
      <td><p>Logical: should only a spatial model be fit (i.e. do not
include spatiotemporal random effects)? By default a spatial-only model
will be fit if there is only one unique value in the time column or the
<code>time</code> argument is left at its default value of <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>nlminb_loops</th>
      <td><p>How many times to run <code><a href='https://rdrr.io/r/stats/nlminb.html'>stats::nlminb()</a></code> optimization.
Sometimes restarting the optimizer at the previous best values aids
convergence. If the maximum gradient is still too large,
try increasing this to <code>2</code>.</p></td>
    </tr>
    <tr>
      <th>newton_steps</th>
      <td><p>How many Newton optimization steps to try with
<code><a href='https://rdrr.io/r/stats/optim.html'>stats::optimHess()</a></code> after running <code><a href='https://rdrr.io/r/stats/nlminb.html'>stats::nlminb()</a></code>. Sometimes aids
convergence.</p></td>
    </tr>
    <tr>
      <th>mgcv</th>
      <td><p>Parse the formula with <code><a href='https://rdrr.io/pkg/mgcv/man/gam.html'>mgcv::gam()</a></code>?</p></td>
    </tr>
    <tr>
      <th>previous_fit</th>
      <td><p>A previously fitted sdmTMB model to initialize the
optimization with. Can greatly speed up fitting. Note that the data and
model must be set up exactly the same way! However, the <code>weights</code> argument
can change, which can be useful for cross-validation.</p></td>
    </tr>
    <tr>
      <th>quadratic_roots</th>
      <td><p>Logical: should quadratic roots be calculated?
Experimental feature for internal use right now. Note: on the sdmTMB side,
the first two coefficients are used to generate the quadratic parameters.
This means that if you want to generate a quadratic profile for depth, and
depth and depth^2 are part of your formula, you need to make sure these are
listed first and that an intercept isn't included. For example, <code>formula = cpue ~ 0 + depth + depth2 + as.factor(year)</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><b>Formula syntax for offsets and threshold models</b></p>
<p>In the model formula, an offset can be included by including <code>+ offset</code> in
the model formula (a reserved word). The offset will be included in any
prediction. <code>offset</code> must be a column in <code>data</code>.</p>
<p>A linear break-point relationship for a covariate can be included via <code>+ breakpt(variable)</code> in the formula, where <code>variable</code> is a single covariate
corresponding to a column in <code>data</code>. In this case the relationship is linear
up to a point then constant.</p>
<p>Similarly, a logistic-function threshold model can be included via <code>+ logistic(variable)</code>. This option models the relationship as a logistic
function of the 50% and 95% values. This is similar to length- or size-based
selectivity in fisheries, and is parameterized by the points at which f(x) =
0.5 or 0.95.</p>
<p>Note that only a single threshold covariate can be included.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>pcod</span>, <span class='va'>year</span> <span class='op'>&gt;=</span> <span class='fl'>2011</span><span class='op'>)</span> <span class='co'># subset for example speed</span>
<span class='va'>pcod_spde</span> <span class='op'>&lt;-</span> <span class='fu'><a href='make_spde.html'>make_spde</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>X</span>, <span class='va'>d</span><span class='op'>$</span><span class='va'>Y</span>, n_knots <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span> <span class='co'># only 50 knots for example speed</span>
<span class='fu'><a href='make_spde.html'>plot_spde</a></span><span class='op'>(</span><span class='va'>pcod_spde</span><span class='op'>)</span>
</div><div class='img'><img src='sdmTMB-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Tweedie:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>depth_scaled</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>d</span>, time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde</span>, family <span class='op'>=</span> <span class='fu'><a href='Beta.html'>tweedie</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m</span>
</div><div class='output co'>#&gt; Spatiotemporal model fit by ML ['sdmTMB']
#&gt; Formula: density ~ 0 + depth_scaled + depth_scaled2 + as.factor(year)
#&gt; SPDE: pcod_spde
#&gt; Family: tweedie(link = 'log')
#&gt;                     coef.est coef.se
#&gt; depth_scaled           -1.40    0.17
#&gt; depth_scaled2          -1.27    0.11
#&gt; as.factor(year)2011     3.82    0.26
#&gt; as.factor(year)2013     3.84    0.27
#&gt; as.factor(year)2015     3.74    0.27
#&gt; as.factor(year)2017     3.09    0.29
#&gt; 
#&gt; Matern range parameter: 9.98
#&gt; Dispersion parameter: 13.16
#&gt; Spatial SD (sigma_O): 2.23
#&gt; Spatiotemporal SD (sigma_E): 2.45
#&gt; ML criterion at convergence: 2920.369</div><div class='input'>
<span class='co'># Contents of the output object:</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "model"               "data"                "spde"               
#&gt;  [4] "formula"             "time_varying"        "threshold_parameter"
#&gt;  [7] "threshold_function"  "mgcv_mod"            "time"               
#&gt; [10] "family"              "response"            "tmb_data"           
#&gt; [13] "tmb_params"          "tmb_map"             "tmb_random"         
#&gt; [16] "tmb_obj"             "reml"                "mgcv"               
#&gt; [19] "gradients"           "bad_eig"             "call"               
#&gt; [22] "sd_report"          </div><div class='input'><span class='va'>m</span><span class='op'>$</span><span class='va'>model</span>
</div><div class='output co'>#&gt; $par
#&gt;        b_j        b_j        b_j        b_j        b_j        b_j   ln_tau_O 
#&gt; -1.4024560 -1.2708202  3.8161986  3.8383476  3.7441859  3.0929014 -0.8070441 
#&gt;   ln_tau_E   ln_kappa     thetaf     ln_phi 
#&gt; -0.8992845 -1.2606425  0.2063718  2.5773727 
#&gt; 
#&gt; $objective
#&gt; [1] 2920.369
#&gt; 
#&gt; $convergence
#&gt; [1] 0
#&gt; 
#&gt; $iterations
#&gt; [1] 48
#&gt; 
#&gt; $evaluations
#&gt; function gradient 
#&gt;       66       49 
#&gt; 
#&gt; $message
#&gt; [1] "relative convergence (4)"
#&gt; </div><div class='input'><span class='va'>r</span> <span class='op'>&lt;-</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>tmb_obj</span><span class='op'>$</span><span class='fu'>report</span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>r</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "range"            "b_rw_t"           "sigma_E"          "eta_rw_i"        
#&gt;  [5] "sigma_O_trend"    "eta_i"            "eta_fixed_i"      "sigma_O"         
#&gt;  [9] "omega_s_trend_A"  "rho"              "omega_s_A"        "epsilon_st_A_vec"</div><div class='input'>
<span class='co'># Run extra optimization steps to help convergence:</span>
<span class='va'>m1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='run_extra_optimization.html'>run_extra_optimization</a></span><span class='op'>(</span><span class='va'>m</span>, nlminb_loops <span class='op'>=</span> <span class='fl'>0</span>, newton_steps <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>$</span><span class='va'>gradients</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.0001550001</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>m1</span><span class='op'>$</span><span class='va'>gradients</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 9.709912e-09</div><div class='input'>
<span class='co'># Binomial:</span>
<span class='va'>pcod_binom</span> <span class='op'>&lt;-</span> <span class='va'>d</span>
<span class='va'>pcod_binom</span><span class='op'>$</span><span class='va'>present</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>pcod_binom</span><span class='op'>$</span><span class='va'>density</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='fl'>1L</span>, <span class='fl'>0L</span><span class='op'>)</span>
<span class='va'>m_bin</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='va'>present</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>depth_scaled</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span>,
  data <span class='op'>=</span> <span class='va'>pcod_binom</span>, time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Gaussian:</span>
<span class='va'>pcod_gaus</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='va'>density</span> <span class='op'>&gt;</span> <span class='fl'>0</span> <span class='op'>&amp;</span> <span class='va'>year</span> <span class='op'>&gt;=</span> <span class='fl'>2013</span><span class='op'>)</span>
<span class='va'>pcod_spde_gaus</span> <span class='op'>&lt;-</span> <span class='fu'><a href='make_spde.html'>make_spde</a></span><span class='op'>(</span><span class='va'>pcod_gaus</span><span class='op'>$</span><span class='va'>X</span>, <span class='va'>pcod_gaus</span><span class='op'>$</span><span class='va'>Y</span>, n_knots <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>
<span class='va'>m_pos</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>density</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>depth_scaled</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span>,
  data <span class='op'>=</span> <span class='va'>pcod_gaus</span>, time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde_gaus</span><span class='op'>)</span>

<span class='co'># With splines via mgcv.</span>
<span class='co'># Make sure to pre-specify an appropriate basis dimension (`k`) since</span>
<span class='co'># the smoothers are not penalized in the current implementation.</span>
<span class='co'># See ?mgcv::choose.k</span>
<span class='va'>m_gam</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>density</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>s</span><span class='op'>(</span><span class='va'>depth_scaled</span>, k <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>pcod_gaus</span>, time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde_gaus</span><span class='op'>)</span>

<span class='co'># Fit a spatial only model:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span>
  <span class='va'>density</span> <span class='op'>~</span> <span class='va'>depth_scaled</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span>, data <span class='op'>=</span> <span class='va'>d</span>,
  spde <span class='op'>=</span> <span class='va'>pcod_spde</span>, family <span class='op'>=</span> <span class='fu'><a href='Beta.html'>tweedie</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Spatial-trend example:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='va'>depth_scaled</span>, data <span class='op'>=</span> <span class='va'>d</span>,
  spde <span class='op'>=</span> <span class='va'>pcod_spde</span>, family <span class='op'>=</span> <span class='fu'><a href='Beta.html'>tweedie</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>,
  spatial_trend <span class='op'>=</span> <span class='cn'>TRUE</span>, time <span class='op'>=</span> <span class='st'>"year"</span><span class='op'>)</span>

<span class='va'>r</span> <span class='op'>&lt;-</span> <span class='va'>m</span><span class='op'>$</span><span class='va'>tmb_obj</span><span class='op'>$</span><span class='fu'>report</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>r</span><span class='op'>$</span><span class='va'>ln_tau_O_trend</span>
</div><div class='output co'>#&gt; NULL</div><div class='input'><span class='va'>r</span><span class='op'>$</span><span class='va'>omega_s_trend</span>
</div><div class='output co'>#&gt;   [1] -0.1933294747  0.0570990929  0.0650273259 -0.2829491395 -0.1463810502
#&gt;   [6] -0.2156049222 -0.1675604555 -0.1875615110 -0.2338687142 -0.1636452564
#&gt;  [11]  0.0225342430  0.0265604968 -0.2409631132 -0.0723380060 -0.0264958006
#&gt;  [16] -0.0708635934  0.0602940869 -0.2109779564  0.0445319378 -0.0280519986
#&gt;  [21] -0.1750036255 -0.0862831926  0.0927205966 -0.0066241859 -0.0450244551
#&gt;  [26] -0.1230190743 -0.1177546027 -0.0281801681  0.0127519944  0.0849249470
#&gt;  [31] -0.1187942113 -0.1377904354 -0.0844258759 -0.0276394739  0.2191063114
#&gt;  [36]  0.2109752166 -0.1074498090 -0.2007743689 -0.0795934653 -0.0785111269
#&gt;  [41]  0.1545481760 -0.0346053552  0.1150005463 -0.0273124314  0.1642911215
#&gt;  [46]  0.1516152494 -0.0407206692  0.0240119649 -0.4010909784 -0.0029614703
#&gt;  [51]  0.1036897069  0.0884310341  0.1012863073  0.0972132304  0.0803581023
#&gt;  [56] -0.2806059073 -0.4662143677  0.0981136077  0.0616895249  0.0388908300
#&gt;  [61] -0.4230511971  0.1063157590  0.1115553395 -0.1419506239 -0.0529693868
#&gt;  [66]  0.0469186087  0.2134282835  0.0379600178  0.0308522755  0.0494637527
#&gt;  [71] -0.0482508488 -0.0244969203 -0.0056293467 -0.2842659985  0.1479743597
#&gt;  [76] -0.0899316484 -0.0952294602 -0.0044961913  0.0817628522  0.0028797327
#&gt;  [81] -0.1655580865 -0.1502843425  0.0486743221  0.0948325216  0.0541222175
#&gt;  [86]  0.0107076284 -0.1279049923  0.0654463355 -0.0184132005 -0.1129167687
#&gt;  [91] -0.1137927802  0.0921760958 -0.0432947730 -0.1183870241 -0.1377648982
#&gt;  [96]  0.1088090575  0.0007275414  0.0189311111  0.0552179982  0.0513278084
#&gt; [101]  0.2174759929  0.0958157095 -0.4318548980 -0.4510155499  0.2539131961
#&gt; [106]  0.3019283275 -0.0663452189 -0.0727959050  0.0481569295 -0.0711013631
#&gt; [111]  0.1216248002 -0.1514294139 -0.1890593478 -0.1150422502 -0.1314009122
#&gt; [116] -0.1583346561 -0.1861415393 -0.0571432890 -0.2506284785  0.1392296599
#&gt; [121]  0.0943942148 -0.1806197871 -0.1604059593 -0.0836412985 -0.3184107290
#&gt; [126] -0.2357781335 -0.2846622611 -0.1724471793  0.0887083000 -0.3445642697
#&gt; [131] -0.3041101888 -0.2213631012  0.0512450643 -0.0257490986  0.0779101759
#&gt; [136] -0.1878187317 -0.0036330725 -0.3035663384 -0.2603322932  0.0182035491
#&gt; [141] -0.1010408395 -0.0665419799  0.1699397127  0.0923682421  0.0853680695
#&gt; [146] -0.0613856231  0.1020769980  0.0535391429 -0.2496273262  0.0807400846
#&gt; [151]  0.1336860190  0.0316095636 -0.0729746169 -0.1319714356 -0.1064305624
#&gt; [156]  0.1152914839 -0.0283558107 -0.2359249635 -0.1951790942 -0.2419725443
#&gt; [161] -0.2563688839  0.1287024442  0.2773986104 -0.0467464710 -0.0809239636
#&gt; [166]  0.0399734965  0.2246869969 -0.3340231836 -0.0173836041  0.1541125998
#&gt; [171]  0.2707721631  0.2405873741  0.0071129828 -0.1275376613 -0.3377600969
#&gt; [176]  0.0086101808  0.0553612272 -0.0029647421  0.0280117936  0.1539280450
#&gt; [181]  0.0859556782 -0.0207554077  0.0672339391 -0.0181244299  0.0039878268
#&gt; [186]  0.1149087616  0.0816083986 -0.0713348457 -0.0376380134  0.0971789321
#&gt; [191]  0.0339289658  0.0858071662  0.0943177517 -0.0593528687 -0.0917129260
#&gt; [196] -0.0664555827  0.1114865824  0.1110788204 -0.0039419189  0.0914187823
#&gt; [201]  0.1052883619 -0.0005850250  0.0025306020 -0.2676713001 -0.0351846392
#&gt; [206] -0.0430681679 -0.2955310859  0.0505812232 -0.0889530421 -0.0433713098
#&gt; [211] -0.2489875907  0.0461526012  0.0690250812  0.0865510901  0.3592133181
#&gt; [216]  0.2873219698 -0.0134936730  0.0106720402  0.2139129929  0.3437402920
#&gt; [221]  0.0048931620  0.0162204795  0.0616696369  0.0051036056 -0.0072646614
#&gt; [226]  0.0134486210  0.0994219613  0.2363593292 -0.0214051121  0.0066021616
#&gt; [231]  0.0411462563 -0.0088001133 -0.2921833029 -0.0023502203 -0.3101623032
#&gt; [236] -0.0050372089 -0.0458268849 -0.0137960016 -0.0697775500 -0.1779511628
#&gt; [241] -0.2386263706  0.0583449343 -0.1085452270 -0.1613626263 -0.0688956531
#&gt; [246] -0.0256339002  0.0079385003 -0.1588493405 -0.0726068081 -0.1134112743
#&gt; [251] -0.1120819186  0.1917356939  0.0423714489  0.0750471291  0.1658428201
#&gt; [256]  0.0941975776  0.0757126828 -0.0291120530 -0.1449455694  0.1337936244
#&gt; [261] -0.1538225464  0.0772371312 -0.1433856701  0.1278297205  0.0876580720
#&gt; [266]  0.0318181639 -0.0976809108  0.1269090641 -0.0783135984 -0.0687428613
#&gt; [271] -0.2544036010  0.1428014980 -0.0796370814  0.0151432537  0.0190025444
#&gt; [276] -0.0036391858 -0.0390909520 -0.0986120038 -0.0787008892 -0.0318915430
#&gt; [281]  0.0517564323 -0.0570073508  0.0161124588  0.0996805636  0.1050676217
#&gt; [286]  0.0585722175  0.0134260994  0.0910821720 -0.2879160015 -0.2468296613
#&gt; [291]  0.0270029063 -0.0905888295 -0.0280078144 -0.0542577351  0.0214301119
#&gt; [296] -0.0127825362 -0.0338797090 -0.3366553394 -0.0961787220 -0.0163312065
#&gt; [301]  0.0277224230  0.0557796536 -0.0267640540  0.0053861860 -0.0153010899
#&gt; [306] -0.1318570410 -0.2793589299 -0.0703233980 -0.0577555713 -0.0504149879
#&gt; [311] -0.0204030479 -0.0700374900  0.0559618721  0.0191152449 -0.1779723826
#&gt; [316] -0.1500679008  0.0188724249  0.0831044183 -0.1138130964  0.0611051422
#&gt; [321] -0.0365014316  0.1021742466  0.0984631386 -0.0951746971  0.0982368983
#&gt; [326]  0.0725962372 -0.1435208709 -0.1437742336 -0.1429335700 -0.1625757425
#&gt; [331] -0.1039020972 -0.1543445136 -0.0761986087 -0.1786205872 -0.2380499438
#&gt; [336]  0.1420656619  0.1507931285 -0.2242973538  0.1625794294 -0.2427040349
#&gt; [341] -0.0341342273 -0.0391450323 -0.0406095963 -0.3319629859 -0.0479408239
#&gt; [346]  0.2304280290  0.2100040058 -0.0727126693 -0.2494563868  0.2144135691
#&gt; [351] -0.0669821621 -0.0280861584 -0.0793192190  0.0448447777 -0.0125890508
#&gt; [356] -0.0063149432 -0.0202989529  0.0712492528  0.0507322361  0.1104946561
#&gt; [361]  0.1799677150 -0.3199121263 -0.0717388571  0.0367661887  0.2044528729
#&gt; [366] -0.5386563069  0.1310513528 -0.1525832069 -0.1747600355 -0.2258487967
#&gt; [371] -0.2798954893 -0.2772417411 -0.2901479848 -0.2022988679 -0.1714446315
#&gt; [376] -0.2463072383 -0.3166042771 -0.3406294518 -0.2932903315 -0.1235981492
#&gt; [381] -0.2365711642 -0.2444697342 -0.2372782104 -0.1407260975 -0.0087354271
#&gt; [386]  0.0464818818 -0.2507967024 -0.2444107958  0.0140946947  0.0275946425
#&gt; [391] -0.2244491493 -0.0197251687  0.0291165162  0.2328475889 -0.0537452839
#&gt; [396] -0.4628455197 -0.0784382701 -0.0214880987  0.2431392582  0.0289160309
#&gt; [401] -0.1875308606 -0.4788081860 -0.3806545132  0.0482974381  0.0453449600
#&gt; [406] -0.3965622839 -0.0466488954 -0.0574229430 -0.3381656383  0.0392543311
#&gt; [411] -0.1501097532 -0.2157597885 -0.0785114474  0.0260134220  0.0180042466
#&gt; [416]  0.0016095380  0.0915849858 -0.0380163053  0.0711138455  0.2482876413
#&gt; [421] -0.1295099945 -0.2015664992 -0.1300349007 -0.1048234361  0.0459182690
#&gt; [426]  0.0327648369 -0.1888695823 -0.1296048437 -0.0524061766  0.0204254680
#&gt; [431] -0.0119878168 -0.1080116363 -0.1636842288 -0.1065133734 -0.0923902946
#&gt; [436] -0.0718149286  0.0785885818 -0.0425877971 -0.1553827663 -0.0612481588
#&gt; [441] -0.1248908241 -0.0887666225 -0.0661425701 -0.1382291297  0.0925034774
#&gt; [446] -0.0649545450 -0.0690267043 -0.0425709104 -0.1212480037  0.1508860923
#&gt; [451] -0.1031087668  0.3253641377  0.0252952247 -0.0747404392 -0.0087619570
#&gt; [456]  0.0028764485 -0.1516128539  0.0617720357 -0.0023057343 -0.1192194150
#&gt; [461]  0.0156412216  0.0622435223 -0.3114674780  0.0016511476 -0.1013811541
#&gt; [466] -0.2644913457 -0.3133830498 -0.3164428224 -0.0719937515 -0.0423715431
#&gt; [471]  0.2150342224 -0.0700327180 -0.0143589941 -0.3126762404 -0.0873955683
#&gt; [476] -0.0771785933  0.1391394149 -0.0783826027  0.0249342711  0.0331173662
#&gt; [481] -0.0251524107  0.0243171932 -0.0001309758 -0.1129169150 -0.0773095038
#&gt; [486]  0.0048786694 -0.2246387112 -0.0312966895 -0.0275168484 -0.1091277427
#&gt; [491] -0.0142628681  0.0458569894  0.0672277998  0.0310335383  0.0449389488
#&gt; [496]  0.0472484159  0.0448684746  0.0253151135 -0.1809514996 -0.1651307539
#&gt; [501]  0.0665863142  0.0130238792  0.0566869435  0.0415217946 -0.0109965248
#&gt; [506] -0.0118364044  0.0033835279  0.0109407211  0.0036322214  0.0658477028
#&gt; [511]  0.0345515506  0.1339865545  0.0702893551 -0.2167495909 -0.2171501860
#&gt; [516] -0.1881993620 -0.2011169575 -0.1808634089 -0.1928707465 -0.1199057810
#&gt; [521] -0.0704983371  0.0313673584 -0.2117520876 -0.1918195693 -0.2219057546
#&gt; [526] -0.1366835630 -0.1790317913 -0.1962919083 -0.1740948664 -0.1307526817
#&gt; [531] -0.1459319556 -0.0520799350 -0.2119258258  0.0774008425  0.0231209143
#&gt; [536]  0.0874129216  0.0900032028 -0.0073456653  0.0003371791  0.1368213681
#&gt; [541]  0.1193006771  0.2428521225  0.1898286992  0.2103068185 -0.0248448643
#&gt; [546] -0.0703532833 -0.0481253222  0.0002554332  0.0485141140  0.0239007561
#&gt; [551] -0.1361220658 -0.1432392043 -0.0270707058 -0.1448787488 -0.0634609753
#&gt; [556]  0.0014852918  0.0058003925 -0.0201738499  0.0690587404  0.0316135922
#&gt; [561]  0.0025141766  0.0457376380 -0.2474456000 -0.0722459349 -0.2712711797
#&gt; [566] -0.0165054747 -0.1492217446  0.1277420837  0.0824165557 -0.0469045798
#&gt; [571] -0.1125654931 -0.3089269968 -0.2252212514 -0.2289458543  0.0432252614
#&gt; [576]  0.1022878343 -0.3026918238 -0.2893354940  0.0068513711 -0.1382419723
#&gt; [581]  0.1470939523  0.0361561950  0.0188428166 -0.0303339041 -0.0678120675
#&gt; [586]  0.0029177658  0.0251341368  0.0360109530  0.0805594540  0.0567621659
#&gt; [591]  0.0647898784  0.0361496009  0.0366209240 -0.3428376953 -0.3482664144
#&gt; [596] -0.2747730102 -0.2986005563 -0.2885369537 -0.3189878812 -0.2188399637
#&gt; [601] -0.0637170757  0.0180748866  0.0793458334  0.1120840667  0.1067604796
#&gt; [606] -0.0679152876 -0.1456645131 -0.1971493966 -0.0777831686  0.1393984389
#&gt; [611]  0.1388776792  0.0383988440 -0.2472955561 -0.0530529947 -0.1960435749
#&gt; [616] -0.2940377689 -0.2661689274 -0.2005255961 -0.1216451733 -0.1535178346
#&gt; [621] -0.0342956848 -0.0417639454 -0.0287951580 -0.0350885650 -0.1290934267
#&gt; [626] -0.0812928657  0.0711725228  0.0348489004  0.1649025818  0.1449658860
#&gt; [631] -0.0297252645  0.1660924239 -0.0173783178 -0.0028514959  0.0168927222
#&gt; [636]  0.2360668073  0.2404184923  0.0598441407  0.1737336857  0.2578426640
#&gt; [641]  0.2658905356 -0.0450516855 -0.0257559788 -0.0210249256  0.0112042123
#&gt; [646] -0.0089254342  0.0077489593 -0.0079359885 -0.0315421390 -0.0228137340
#&gt; [651]  0.0179941087 -0.0243487363  0.0001366652  0.0150686423 -0.0466802357
#&gt; [656] -0.0179106896 -0.0207644526 -0.0226302903  0.1255770984 -0.0971240418
#&gt; [661] -0.0884418030 -0.1504235330 -0.1583193285 -0.1696768489 -0.0021862533
#&gt; [666] -0.0693576759  0.0868525697  0.0207972135  0.1208462292 -0.1203989840
#&gt; [671] -0.2220392605 -0.0589645266 -0.1089640367  0.1735777099  0.0991971598
#&gt; [676] -0.1057547290 -0.5887143421 -0.2722786951 -0.4026026280 -0.4116585368
#&gt; [681] -0.4136074482 -0.3895889816  0.0343231144  0.0098208124 -0.0495972126
#&gt; [686]  0.1610892666 -0.0435875667  0.0177388297 -0.0599909636  0.0616349035
#&gt; [691] -0.0131798117  0.0550284873  0.0402089651  0.0347207667  0.0116442344
#&gt; [696]  0.0311319245 -0.0075876775 -0.0104373820 -0.0141959893 -0.2404421236
#&gt; [701] -0.1105418290 -0.1715125997 -0.1461405695 -0.1059960319 -0.1512165878
#&gt; [706] -0.0353459464 -0.0999189274 -0.0721483921 -0.0943807925 -0.1857741590
#&gt; [711] -0.0586292233 -0.0891289382 -0.1594727924 -0.2702327168 -0.0022995183
#&gt; [716] -0.3567644741 -0.2356337149 -0.0007458906 -0.1267678252 -0.0613549787
#&gt; [721] -0.0478156194 -0.0696540856  0.1069417487  0.1032562707  0.0776689503
#&gt; [726] -0.0562823264 -0.1882468426 -0.1755380818 -0.2212953494 -0.1428321358
#&gt; [731] -0.1237800716 -0.1422978410 -0.1675656861 -0.2214736704 -0.2449422843
#&gt; [736]  0.0938707289  0.1269771892 -0.0658083968 -0.0803365550 -0.1443404277
#&gt; [741] -0.0300485024 -0.1273061946 -0.0427017145 -0.0215075003  0.0381530603
#&gt; [746]  0.0226569236  0.0725001197  0.0162663516  0.0237891789  0.0765606522
#&gt; [751]  0.0501811403  0.0313575130  0.0352490149 -0.2681848892 -0.2261681437
#&gt; [756] -0.2055936453 -0.1826288664 -0.2686744585 -0.2778138213 -0.2993504513
#&gt; [761] -0.2894670419 -0.2758343385 -0.1938270641 -0.2341534944 -0.2320682054
#&gt; [766] -0.2221312718 -0.1867041649 -0.0526110064 -0.0262693315 -0.2018368733
#&gt; [771]  0.1132773513  0.1420003877 -0.1533165280 -0.1835465185 -0.1849241745
#&gt; [776] -0.1710404305 -0.0922938789 -0.1691072951 -0.1466563960 -0.1637842065
#&gt; [781] -0.0995911542 -0.1601262384 -0.1314381001 -0.2162402469 -0.0126965435
#&gt; [786] -0.0833908331  0.1788189302  0.1942255485 -0.0844521495 -0.1501907798
#&gt; [791] -0.1882559122 -0.2148551056 -0.2332946785 -0.2534851530 -0.4197005491
#&gt; [796] -0.4685052327 -0.5456565555 -0.4187351047 -0.5021280196 -0.3557227357
#&gt; [801] -0.2637671499 -0.2515650742 -0.2737615063 -0.2943615503 -0.3330821054
#&gt; [806] -0.0947586055 -0.0936250957 -0.0687668996 -0.0860869863 -0.0417826429
#&gt; [811]  0.0235525415  0.0050677213 -0.0397768249 -0.1524993821 -0.0628660453
#&gt; [816] -0.0888401359 -0.0139969579  0.0073639069 -0.0038189286 -0.1568907976
#&gt; [821] -0.1120991992 -0.1444967243  0.0041194093  0.0232637637  0.0026147953
#&gt; [826] -0.0587827511 -0.0643661694 -0.0236348334 -0.0594184530 -0.0012906715
#&gt; [831]  0.1058171935  0.0642900175  0.1234847993 -0.0389493207 -0.2114310150
#&gt; [836] -0.0245525562 -0.0768889599  0.0439060020 -0.2663363852 -0.0993977978
#&gt; [841] -0.1857089919  0.1862134622  0.1670366239  0.1446851629  0.0554588135
#&gt; [846]  0.0377434972  0.0477295757  0.0905942179  0.0865038070  0.0899534428
#&gt; [851]  0.0934077173 -0.3089500711 -0.1637555021 -0.3125335240  0.1487473042
#&gt; [856]  0.1702019299  0.2674530914  0.2621902536  0.1144548330 -0.3125415195
#&gt; [861]  0.1608109684  0.1220032182  0.0120276809  0.2241803539  0.1774738467
#&gt; [866]  0.2498289700  0.0010752804  0.0113122505  0.0739527075 -0.0109195084
#&gt; [871] -0.0076703205  0.0680120360  0.0508451039  0.0599181538  0.0039149578
#&gt; [876]  0.0022871762 -0.0155737665 -0.0411321166  0.0913652492  0.1569762685
#&gt; [881]  0.1536086984 -0.0803714772 -0.0459628871  0.2312268623  0.0654185935
#&gt; [886]  0.2552656854 -0.0148354304  0.0292830357 -0.0062265680 -0.0432040517
#&gt; [891] -0.0380478902 -0.1296436388 -0.0983895931 -0.2325339345 -0.2073928165
#&gt; [896] -0.2876341351 -0.2947031882 -0.0933048210  0.0664953747  0.0139970127
#&gt; [901]  0.0035635750 -0.0134067578 -0.0014374710  0.0014271537 -0.0333630867
#&gt; [906] -0.1276215371 -0.2247422664 -0.1144152755 -0.1464114888 -0.0959156483
#&gt; [911]  0.1068627567 -0.1273528648  0.0534162411  0.1648158732  0.1336392361
#&gt; [916]  0.1715737263  0.1598829205  0.0714165062  0.0505385994 -0.0918877914
#&gt; [921] -0.1336725709 -0.1762453288  0.1273404464  0.0007921581  0.2015452737
#&gt; [926] -0.1564099648 -0.0901104458 -0.0799584372  0.0049868971  0.0014181847
#&gt; [931]  0.1128897248  0.0278714272 -0.0563503183  0.0891352636  0.1263121272
#&gt; [936] -0.1040746529 -0.0619364906 -0.0750448125 -0.0352892482  0.0241031963
#&gt; [941]  0.0990046540 -0.0446744536 -0.1623088981 -0.2637757067 -0.0718943507
#&gt; [946]  0.1332385457 -0.0020489979 -0.0807344055 -0.0850923565  0.0106831952
#&gt; [951] -0.0168547357  0.0280144624 -0.0601684487 -0.1194078053  0.0933063595
#&gt; [956] -0.0646786275 -0.0201871200  0.0025527181  0.1357254161 -0.2128557529
#&gt; [961] -0.1890147241 -0.1930691394 -0.1508894123 -0.1771555828 -0.2080457705
#&gt; [966] -0.1063959473  0.1584288175  0.1436380447  0.0982162101</div><div class='input'>
<span class='co'># Time-varying effects of depth and depth squared:</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='va'>density</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,
  time_varying <span class='op'>=</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>depth_scaled</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span>,
  data <span class='op'>=</span> <span class='va'>d</span>, time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde</span>, family <span class='op'>=</span> <span class='fu'><a href='Beta.html'>tweedie</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># See the b_rw_t estimates; these are the time-varying (random walk) effects.</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>$</span><span class='va'>sd_report</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>19</span>,<span class='op'>]</span>
</div><div class='output co'>#&gt;            Estimate Std. Error
#&gt; b_j       4.0682883 0.26942690
#&gt; b_j       3.6529051 0.26343541
#&gt; b_j       3.9120831 0.27551325
#&gt; b_j       3.4096900 0.30170428
#&gt; ln_tau_O -1.0743409 2.02969826
#&gt; ln_tau_E -1.0741949 2.06002537
#&gt; ln_kappa -1.1203076 1.09221923
#&gt; thetaf    0.2133878 0.06548503
#&gt; ln_phi    2.5631898 0.04950065
#&gt; ln_tau_V -1.4169636 0.84072262
#&gt; ln_tau_V -0.3303451 0.47704575
#&gt; b_rw_t   -0.7172262 0.13653035
#&gt; b_rw_t   -0.7098664 0.12278326
#&gt; b_rw_t   -0.6261887 0.14262241
#&gt; b_rw_t   -0.9367848 0.23672198
#&gt; b_rw_t   -1.7552873 0.26076251
#&gt; b_rw_t   -0.9427072 0.15106165
#&gt; b_rw_t   -1.5079413 0.22602370
#&gt; b_rw_t   -2.0829075 0.34751896</div><div class='input'>
<span class='co'># Linear breakpoint model on depth:</span>
<span class='va'>m_pos</span> <span class='op'>&lt;-</span> <span class='fu'>sdmTMB</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>density</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>breakpt</span><span class='op'>(</span><span class='va'>depth_scaled</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>depth_scaled2</span>, data <span class='op'>=</span> <span class='va'>pcod_gaus</span>,
  time <span class='op'>=</span> <span class='st'>"year"</span>, spde <span class='op'>=</span> <span class='va'>pcod_spde_gaus</span><span class='op'>)</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sean C. Anderson, Eric J. Ward, Lewis A. K. Barnett, Philina A. English.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


